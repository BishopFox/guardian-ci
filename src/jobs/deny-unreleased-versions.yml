executor: default

working_directory: ~/repo

steps:
  - checkout
  - run:
      name: Check if go.mod has unreleased versions or replaces
      command: |
        matches=$$(go mod graph | awk '{print $$2}' | grep 'github.com/BishopFox' | egrep -v 'v[0-9]+.[0-9]+.[0-9]+$$' | grep -v groot); \
        test -z "$$matches" || (printf "\nfailing build as go.mod references unreleased library versions: \n%s\n" "$$matches" >&2 && exit 1);
        matches=$$(grep -e '^replace' go.mod); \
        test -z "$$matches" || (printf "\nfailing build as go.mod contains replace statements: \n%s\n" "$$matches" >&2 && exit 1);
